---
title: "Initialize Payment"
description: "Start the user payment flow via the AcountPay SDK (redirects to user.acountpay.com to link IBAN)"
---

After setting up the SDK, you can start the user-first flow. This redirects the customer to the AcountPay user portal to securely link IBAN and consent to payment, then returns them to your app.

## Basic User Flow

### ESM/CommonJS Usage

```typescript
import AcountPay from '@acountpay/sdk';

const sdk = new AcountPay({
  clientId: process.env.REACT_APP_ACOUNTPAY_CLIENT_ID!,
  env: process.env.REACT_APP_ACOUNTPAY_ENV || 'production',
  // Optionally pass apiBaseUrl here, or set window.__ACOUNTPAY_API_URL__ in HTML
  // apiBaseUrl: 'https://acount-apis-7886a9e16dc3.herokuapp.com',
});

localStorage.setItem('paymentType', 'user'); // optional tag used by demos

await sdk.initiateUserPaymentByEmail({
  amount: 1, // major units (1 = 1 DKK)
  requestId: 'PAY' + String(Math.random()).split('.')[1].slice(0, 6),
  callbackURL: process.env.REACT_APP_ACOUNTPAY_REDIRECT_URI!,
  // authToken: '<Bearer token>' // optional if your backend requires it
});
```

### UMD Usage

```html
<script>
  // Runtime configuration
  window.__ACOUNTPAY_API_URL__ = 'https://acount-apis-7886a9e16dc3.herokuapp.com';
  window.__ACOUNTPAY_ENV__ = 'sandbox';
</script>
<script src="https://unpkg.com/@acountpay/sdk@1.0.2/dist/acount.umd.js"></script>
<script>
  // IMPORTANT: Global is "Acount" in UMD, not "AcountPay"
  const sdk = new Acount({ 
    clientId: 'your-client-id',
    env: 'sandbox'
  });

  async function pay() {
    localStorage.setItem('paymentType', 'user');
    await sdk.initiateUserPaymentByEmail({
      amount: 1,
      requestId: 'PAY' + Date.now(),
      callbackURL: 'https://your-callback-url.com'
    });
  }
</script>
```

## Parameters

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `amount` | `number` | ✅ Yes | Payment amount in major currency units (e.g., 1 = 1 DKK) |
| `requestId` | `string` | ✅ Yes | Unique request identifier (e.g., PAY123456) |
| `callbackURL` | `string` | ✅ Yes | URL the user is returned to after the portal flow |
| `authToken` | `string` | ❌ No | Bearer token if your backend enforces authentication for this endpoint |

## API Endpoint

The SDK calls your backend endpoint:

POST {BASE}/sdk/users/{clientId}/payment-request

**Request Body:**
```json
{ 
  "amount": 1, 
  "requestId": "PAY123456", 
  "callbackURL": "https://your-callback-url.com" 
}
```

**Success Response:**
```json
{ 
  "redirectTo": "https://user.acountpay.com/flow/..." 
}
```

The SDK automatically redirects the browser to the `redirectTo` URL.

## Complete Examples

### Simple HTML Page

```html
<!DOCTYPE html>
<html>
<head>
  <script>
    // Runtime configuration
    window.__ACOUNTPAY_API_URL__ = 'https://acount-apis-7886a9e16dc3.herokuapp.com';
    window.__ACOUNTPAY_ENV__ = 'sandbox';
  </script>
  <script src="https://unpkg.com/@acountpay/sdk@1.0.2/dist/acount.umd.js"></script>
</head>
<body>
  <button onclick="pay()">Pay with AcountPay</button>
  <script>
    const sdk = new Acount({ 
      clientId: 'your-client-id',
      env: 'sandbox'
    });
    
    async function pay() {
      try {
        localStorage.setItem('paymentType', 'user');
        await sdk.initiateUserPaymentByEmail({
          amount: 1,
          requestId: 'PAY' + Date.now(),
          callbackURL: 'https://your-callback-url.com'
        });
      } catch (error) {
        console.error('Payment failed:', error);
      }
    }
  </script>
</body>
</html>
```

### React Component

```typescript
import { useEffect, useState } from 'react';
import AcountPay from '@acountpay/sdk';

export function PayButton() {
  const [sdk, setSdk] = useState<AcountPay | null>(null);
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    const acountSdk = new AcountPay({
      clientId: process.env.REACT_APP_ACOUNTPAY_CLIENT_ID!,
      env: process.env.REACT_APP_ACOUNTPAY_ENV || 'production',
    });
    setSdk(acountSdk);
  }, []);

  const handlePay = async () => {
    if (!sdk) return;
    
    setLoading(true);
    try {
      localStorage.setItem('paymentType', 'user');
      await sdk.initiateUserPaymentByEmail({
        amount: 1,
        requestId: 'PAY' + Date.now(),
        callbackURL: process.env.REACT_APP_ACOUNTPAY_REDIRECT_URI!,
      });
    } catch (error) {
      console.error('Payment failed:', error);
      setLoading(false);
    }
  };

  return (
    <button onClick={handlePay} disabled={loading || !sdk}>
      {loading ? 'Processing...' : 'Pay with AcountPay'}
    </button>
  );
}
```

## Flow Overview

1. **SDK Setup**: Initialize with your Client ID and environment
2. **Payment Request**: SDK calls your backend with payment details
3. **Backend Response**: Backend returns a `redirectTo` URL for the AcountPay user portal
4. **User Portal**: Browser redirects to portal where user:
   - Links IBAN to their account
   - Authenticates and consents to payment
5. **Return**: User is redirected back to your `callbackURL`

## Handling Results

After the user returns to your `callbackURL`:

1. **Verify Payment State**: Check with your backend to confirm payment status (recommended)
2. **Parse URL Parameters**: Extract any query parameters your backend attaches to the redirect
3. **Display Result**: Show success/failure to the user based on your backend's confirmation

### Example Callback Handler

```html
<!-- callback.html -->
<script>
  // Parse URL parameters
  const urlParams = new URLSearchParams(window.location.search);
  const status = urlParams.get('status');
  const requestId = urlParams.get('requestId');
  
  if (status === 'success') {
    console.log('Payment completed successfully');
    // Verify with your backend using requestId
  } else if (status === 'cancelled') {
    console.log('Payment was cancelled');
  } else {
    console.log('Payment status:', status);
  }
</script>
```

## Important Notes

- **Environment Configuration**: Always set the `env` option to match your environment (`'sandbox'` or `'production'`)
- **Whitelisting**: Ensure your app origin and callbackURL are whitelisted on your backend
- **Currency Units**: Use major currency units for amounts (e.g., `1` = 1 DKK)
- **Authentication**: Provide a bearer token if your environment requires authentication
- **UMD vs ESM**: Use `Acount` constructor for UMD builds, `AcountPay` for ESM/CommonJS

## Troubleshooting

### 400 Bad Request
- **Cause**: Missing or incorrect parameters
- **Solution**: Check `clientId`, `callbackURL`, and `amount` units
- **Common Issues**: 
  - Missing environment configuration
  - Incorrect callback URL format
  - Amount not in major units

### 403 Forbidden
- **Cause**: Authentication or authorization issues
- **Solution**: 
  - Check if bearer token is required and provided
  - Verify client ID is correct
  - Ensure app origin is whitelisted

### "AcountPay is not defined" Error
- **Cause**: Using wrong constructor name with UMD build
- **Solution**: Use `new Acount({ clientId: '...' })` for UMD builds

### No Redirect After Payment
- **Cause**: Backend not returning correct response
- **Solution**: Ensure your backend returns `{ redirectTo: "<URL>" }` for successful requests

### Environment Issues
- **Cause**: Missing or incorrect environment configuration
- **Solution**: Set `env: 'sandbox'` or `env: 'production'` in SDK initialization

## Error Handling
Common HTTP status codes and their meanings:

| Status | Meaning | Common Causes |
| ------ | ------- | ------------- |
| 400    | Bad Request | Invalid parameters, missing required fields |
| 401    | Unauthorized | Invalid client ID or missing authentication |
| 403    | Forbidden | Insufficient permissions or blocked origin |
| 500    | Server Error | Internal server error, try again later |

## Troubleshooting Common Issues
- **400 Bad Request**: Check that all required parameters are provided and correctly formatted
- **CORS Errors**: Ensure your domain is whitelisted on the backend
- **Callback URL Issues**: Verify the URL is accessible and properly formatted
