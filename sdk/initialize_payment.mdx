---
title: "Initialize Payment"
description: "Start the user payment flow via the AcountPay SDK (redirects to user.acountpay.com to link IBAN)"
---

After setting up the SDK, you can start the user-first flow. This redirects the customer to the AcountPay user portal to securely link IBAN and consent to payment, then returns them to your app.

## Parameters

| Parameter     | Type     | Required | Description                                                            |
| ------------- | -------- | -------- | ---------------------------------------------------------------------- |
| `amount`      | `number` | ✅ Yes    | Payment amount in major currency units (e.g., 1 = 1 DKK)               |
| `requestId`   | `string` | ✅ Yes    | Unique request identifier (e.g., PAY123456)                            |
| `callbackURL` | `string` | ✅ Yes    | URL the user is returned to after the portal flow                      |
| `authToken`   | `string` | ❌ No     | Bearer token if your backend enforces authentication for this endpoint |

## API Endpoint

The SDK calls your backend endpoint:

POST BASE/sdk/users/clientId/payment-request

**Request Body:**

```json
{ 
  "amount": 1, 
  "requestId": "PAY123456", 
  "callbackURL": "https://your-callback-url.com" 
}
```

**Success Response:**

```json
{ 
  "redirectTo": "https://user.acountpay.com/flow/..." 
}
```

The SDK automatically redirects the browser to the `redirectTo` URL.

## Complete Examples

### Simple HTML Page

```html
<!DOCTYPE html>
<html>
<head>
  <script>
    // Runtime configuration
    window.__ACOUNTPAY_API_URL__ = 'https://acount-apis-7886a9e16dc3.herokuapp.com';
    window.__ACOUNTPAY_ENV__ = 'sandbox';
  </script>
  <script src="https://unpkg.com/@acountpay/sdk@1.0.0/dist/acount.umd.js"></script>
</head>
<body>
  <button onclick="pay()">Pay with AcountPay</button>
  <script>
    const sdk = new Acount({ 
      clientId: 'your-client-id',
      env: 'sandbox'
    });
    
    async function pay() {
      try {
        localStorage.setItem('paymentType', 'user');
        await sdk.initiateUserPaymentByEmail({
          amount: 1,
          requestId: 'PAY' + Date.now(),
          callbackURL: 'https://your-callback-url.com'
        });
      } catch (error) {
        console.error('Payment failed:', error);
      }
    }
  </script>
</body>
</html>
```

### Framework Components

<Tabs>
  <Tab title="React">

```typescript
import { useEffect, useState } from 'react';
import AcountPay from '@acountpay/sdk';

export function PayButton() {
  const [sdk, setSdk] = useState<AcountPay | null>(null);
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    const acountSdk = new AcountPay({
      clientId: process.env.REACT_APP_ACOUNTPAY_CLIENT_ID!,
      env: process.env.REACT_APP_ACOUNTPAY_ENV || 'production',
    });
    setSdk(acountSdk);
  }, []);

  const handlePay = async () => {
    if (!sdk) return;
    
    setLoading(true);
    try {
      localStorage.setItem('paymentType', 'user');
      await sdk.initiateUserPaymentByEmail({
        amount: 1,
        requestId: 'PAY' + Date.now(),
        callbackURL: process.env.REACT_APP_ACOUNTPAY_REDIRECT_URI!,
      });
    } catch (error) {
      console.error('Payment failed:', error);
      setLoading(false);
    }
  };

  return (
    <button onClick={handlePay} disabled={loading || !sdk}>
      {loading ? 'Processing...' : 'Pay with AcountPay'}
    </button>
  );
}
```

  </Tab>
  <Tab title="Vue.js">

```javascript
<template>
  <button @click="handlePay" :disabled="loading || !sdk">
    {{ loading ? 'Processing...' : 'Pay with AcountPay' }}
  </button>
</template>

<script>
import AcountPay from '@acountpay/sdk';

export default {
  name: 'PayButton',
  data() {
    return {
      sdk: null,
      loading: false
    };
  },
  mounted() {
    this.sdk = new AcountPay({
      clientId: process.env.VUE_APP_ACOUNTPAY_CLIENT_ID,
      env: process.env.VUE_APP_ACOUNTPAY_ENV || 'production'
    });
  },
  methods: {
    async handlePay() {
      if (!this.sdk) return;
      
      this.loading = true;
      try {
        localStorage.setItem('paymentType', 'user');
        await this.sdk.initiateUserPaymentByEmail({
          amount: 1,
          requestId: 'PAY' + Date.now(),
          callbackURL: process.env.VUE_APP_ACOUNTPAY_REDIRECT_URI
        });
      } catch (error) {
        console.error('Payment failed:', error);
        this.loading = false;
      }
    }
  }
};
</script>
```

  </Tab>
  <Tab title="Angular">

```typescript
import { Component, OnInit } from '@angular/core';
import AcountPay from '@acountpay/sdk';

@Component({
  selector: 'app-pay-button',
  template: `
    <button 
      (click)="handlePay()" 
      [disabled]="loading || !sdk">
      {{ loading ? 'Processing...' : 'Pay with AcountPay' }}
    </button>
  `
})
export class PayButtonComponent implements OnInit {
  sdk: AcountPay | null = null;
  loading = false;

  ngOnInit() {
    this.sdk = new AcountPay({
      clientId: this.envService.get('ACOUNTPAY_CLIENT_ID'),
      env: this.envService.get('ACOUNTPAY_ENV') || 'production'
    });
  }

  async handlePay() {
    if (!this.sdk) return;
    
    this.loading = true;
    try {
      localStorage.setItem('paymentType', 'user');
      await this.sdk.initiateUserPaymentByEmail({
        amount: 1,
        requestId: 'PAY' + Date.now(),
        callbackURL: this.envService.get('ACOUNTPAY_REDIRECT_URI')
      });
    } catch (error) {
      console.error('Payment failed:', error);
      this.loading = false;
    }
  }
}
```

  </Tab>
</Tabs>

## Flow Overview

1. **SDK Setup**: Initialize with your Client ID and environment
2. **Payment Request**: SDK calls your backend with payment details
3. **Backend Response**: Backend returns a `redirectTo` URL for the AcountPay user portal
4. **User Portal**: Browser redirects to portal where user:
   - Links IBAN to their account
   - Authenticates and consents to payment
5. **Return**: User is redirected back to the`callbackURL`specified during onboarding

## Important Notes

- **Environment Configuration**: Always set the `env` option to match your environment (`'sandbox'` or `'production'`)
- **Whitelisting**: Ensure your app origin and callbackURL are whitelisted on your backend
- **Currency Units**: Use major currency units for amounts (e.g., `1` = 1 DKK)
- **Authentication**: Provide a bearer token if your environment requires authentication

## Troubleshooting

### 400 Bad Request

- **Cause**: Missing or incorrect parameters
- **Solution**: Check `clientId`, `callbackURL`, and `amount` units
- **Common Issues**:
  - Missing environment configuration
  - Incorrect callback URL format
  - Amount not in major units

### 403 Forbidden

- **Cause**: Authentication or authorization issues
- **Solution**:
  - Check if bearer token is required and provided
  - Verify client ID is correct
  - Ensure app origin is whitelisted

### "AcountPay is not defined" Error

- **Cause**: Using wrong constructor name with UMD build
- **Solution**: Use `new Acount({ clientId: '...' })` for UMD builds

### No Redirect After Payment

- **Cause**: Backend not returning correct response
- **Solution**: Ensure your backend returns `{ redirectTo: "<URL>" }` for successful requests

### Environment Issues

- **Cause**: Missing or incorrect environment configuration
- **Solution**: Set `env: 'sandbox'` or `env: 'production'` in SDK initialization

## Error Handling

Common HTTP status codes and their meanings:

| Status | Meaning      | Common Causes                               |
| ------ | ------------ | ------------------------------------------- |
| 400    | Bad Request  | Invalid parameters, missing required fields |
| 401    | Unauthorized | Invalid client ID or missing authentication |
| 403    | Forbidden    | Insufficient permissions or blocked origin  |
| 500    | Server Error | Internal server error, try again later      |

## Troubleshooting Common Issues

- **400 Bad Request**: Check that all required parameters are provided and correctly formatted
- **CORS Errors**: Ensure your domain is whitelisted on the backend
- **Callback URL Issues**: Verify the URL is accessible and properly formatted